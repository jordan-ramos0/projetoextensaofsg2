<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>extensionista</title>
<style>
html,body{margin:0;padding:0;height:100%;width:100%;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:#fafafa;}
header{position:fixed;top:0;left:0;right:0;height:60px;background:rgb(60,57,107);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 12px;z-index:1000;box-shadow:0 2px 5px rgba(0,0,0,.15);}
#menuToggle{font-size:22px;line-height:1;color:#fff;cursor:pointer;user-select:none;display:block;}
#hub{position:fixed;top:60px;left:0;width:220px;bottom:0;background:rgba(245,245,245,.98);overflow-y:auto;z-index:1600;transform:translateX(-200px);transition:transform .22s ease;box-shadow:2px 0 6px rgba(0,0,0,.12);}
#hub.open{transform:translateX(0);}
#hub ul{list-style:none;margin:0;padding:0;}
#hub li{padding:12px 10px;cursor:pointer;border-bottom:1px solid #e6e6e6;}
#hub li.hovered,#hub li:hover,#hub li:focus{background:#e9e9e9;outline:none;}
#content{margin-top:60px;padding:10px;box-sizing:border-box;height:calc(100vh - 60px);overflow-y:auto;overflow-x:hidden;background:#fafafa;display:flex;flex-direction:column;align-items:flex-start;gap:10px;touch-action:none;}
canvas.page-canvas{display:block;background:#fff;}
#zoomControls{position:fixed;right:18px;bottom:18px;z-index:1600;display:flex;flex-direction:column;gap:8px;}
#zoomControls button{border:0;background:#39496b;color:#fff;padding:10px 12px;border-radius:8px;font-size:18px;cursor:pointer;touch-action:manipulation;}
#zoomControls button:active{transform:scale(.98);}
#tapStrip{position:fixed;top:60px;left:0;width:20px;height:calc(100vh - 60px);z-index:1700;}
</style>
</head>
<body>
<header>
<h1 style="font-size:18px;margin:0;color:#fff;">que nome botar?</h1>
<div id="menuToggle" aria-label="Abrir menu" role="button" tabindex="0">☰</div>
</header>

<div id="hub" aria-hidden="true"><ul id="pdfList" aria-label="Lista de PDFs"></ul></div>
<div id="tapStrip"></div>
<div id="content" aria-live="polite"></div>
<div id="zoomControls" aria-hidden="false">
<button id="zoomIn" aria-label="Aumentar zoom">＋</button>
<button id="zoomOut" aria-label="Diminuir zoom">−</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.min.js";

const pdfIndexData = [
{ title:"Página 1 - Saúde Geral", desktop:"pages/Etinerário.pdf", mobile:"pages/Etinerário2.pdf" },
{ title:"Página 2 - Nutrição e Bem-Estar", desktop:"pages/2-desktop.pdf", mobile:"pages/2-mobile.pdf" },
{ title:"Página 3 - Exercício e Movimento", desktop:"pages/3-desktop.pdf", mobile:"pages/3-mobile.pdf" },
{ title:"Página 4 - Sono e Recuperação", desktop:"pages/4-desktop.pdf", mobile:"pages/4-mobile.pdf" }
];

const body=document.body, hub=document.getElementById('hub'), pdfList=document.getElementById('pdfList');
const content=document.getElementById('content'), menuToggle=document.getElementById('menuToggle');
const zoomInBtn=document.getElementById('zoomIn'), zoomOutBtn=document.getElementById('zoomOut');
const tapStrip=document.getElementById('tapStrip');

let currentPdfDoc=null, currentEntry=null, baseScale=null, zoomFactor=1, ZOOM_STEP=1.25;

/* Populate PDF list */
pdfIndexData.forEach(entry=>{
  const li=document.createElement('li');
  li.textContent=entry.title;
  li.tabIndex=0;
  
  // Always select entry on click
  li.addEventListener('click',()=>{
    selectEntry(entry);
    closeHub();
  });

  li.addEventListener('keydown',e=>{
    if(e.key==='Enter') li.click();
  });

  pdfList.appendChild(li);
});

/* Touch detection */
const hasTouch=('ontouchstart' in window)||(navigator.maxTouchPoints>0)||(navigator.msMaxTouchPoints>0);
if(hasTouch) body.classList.add('touch');

/* Sidebar open/close */
function openHub(){hub.classList.add('open');}
function closeHub(){hub.classList.remove('open');}
function toggleHub(){hub.classList.toggle('open');}

/* Desktop hover & click */
hub.addEventListener('mouseenter',()=>{if(!hasTouch) openHub();});
tapStrip.addEventListener('mouseenter',()=>{if(!hasTouch) openHub();});
hub.addEventListener('mouseleave',()=>{if(!hasTouch) closeHub();});
menuToggle.addEventListener('click',toggleHub);
menuToggle.addEventListener('keydown',e=>{if(e.key==='Enter') toggleHub();});

/* Mobile tap strip */
tapStrip.addEventListener('click',toggleHub);

/* Click outside closes hub */
document.addEventListener('click',ev=>{
  if(hub.contains(ev.target) || ev.target===menuToggle || ev.target===tapStrip) return;
  closeHub();
});

/* Helpers */
function getContentInnerWidth(){
  const style=getComputedStyle(content);
  return Math.max(1,content.clientWidth - (parseFloat(style.paddingLeft||0)+parseFloat(style.paddingRight||0)));
}
async function probeFirstPage(url){
  try{
    const loading=pdfjsLib.getDocument(url);
    const pdf=await loading.promise;
    const page=await pdf.getPage(1);
    const viewport=page.getViewport({scale:1});
    return {pdf,viewport};
  }catch(err){console.error('probe failed',url,err); return null;}
}

/* Select PDF entry */
async function selectEntry(entry){
  currentEntry=entry;
  if(currentPdfDoc){try{currentPdfDoc.destroy();}catch(e){} currentPdfDoc=null;}
  content.innerHTML=''; zoomFactor=1; content.style.overflowX='hidden';
  const innerW=getContentInnerWidth(), innerH=content.clientHeight;
  const [desktopProbe,mobileProbe]=await Promise.all([entry.desktop?probeFirstPage(entry.desktop):null,entry.mobile?probeFirstPage(entry.mobile):null]);
  let chosen=null;
  if(desktopProbe && mobileProbe){
    const dh=innerW/desktopProbe.viewport.width*desktopProbe.viewport.height;
    const mh=innerW/mobileProbe.viewport.width*mobileProbe.viewport.height;
    chosen = (Math.abs(mh-innerH)<Math.abs(dh-innerH))? {url:entry.mobile,probe:mobileProbe} : {url:entry.desktop,probe:desktopProbe};
    if(chosen.url===entry.mobile) try{desktopProbe.pdf.destroy();}catch{}
    else try{mobileProbe.pdf.destroy();}catch{}
  } else if(desktopProbe) chosen={url:entry.desktop,probe:desktopProbe};
  else if(mobileProbe) chosen={url:entry.mobile,probe:mobileProbe};
  else {content.innerHTML='<p style="padding:20px;color:#333">Nenhum PDF disponível.</p>'; return;}
  currentPdfDoc=chosen.probe.pdf;
  baseScale=(innerW-0.5)/chosen.probe.viewport.width;
  await renderPdfDocument(currentPdfDoc);
}

/* Render PDF pages */
async function renderPdfDocument(pdfDoc){
  content.innerHTML=''; content.scrollTop=0; content.scrollLeft=0;
  const effectiveScale=baseScale*zoomFactor, innerW=getContentInnerWidth();
  content.style.overflowX=(zoomFactor>1)?'auto':'hidden';
  for(let p=1;p<=pdfDoc.numPages;p++){
    const page=await pdfDoc.getPage(p);
    const vp=page.getViewport({scale:effectiveScale});
    const canvas=document.createElement('canvas');
    canvas.className='page-canvas';
    canvas.width=Math.max(1,Math.round(vp.width));
    canvas.height=Math.max(1,Math.round(vp.height));
    canvas.style.margin=(canvas.width<=innerW+0.5)?'0 auto 10px auto':'0 0 10px 0';
    const ctx=canvas.getContext('2d',{alpha:false});
    ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
    content.appendChild(canvas);
    await page.render({canvasContext:ctx,viewport:vp}).promise;
    if(page.cleanup) try{page.cleanup();}catch{}
  }
}

/* Zoom buttons */
zoomInBtn.addEventListener('click',()=>{zoomFactor*=ZOOM_STEP;if(currentPdfDoc) renderPdfDocument(currentPdfDoc);});
zoomOutBtn.addEventListener('click',()=>{zoomFactor/=ZOOM_STEP;if(zoomFactor<0.125) zoomFactor=0.125;if(currentPdfDoc) renderPdfDocument(currentPdfDoc);});

/* Resize debounce */
function debounce(fn,ms=200){let t;return(...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms);};}
window.addEventListener('resize',debounce(()=>{if(currentEntry) selectEntry(currentEntry);},220));

/* Pinch-to-zoom */
if('PointerEvent' in window && hasTouch){
  let pointerMap=new Map(), pinchInitialDistance=null, pinchInitialZoom=null, pinchDebounce=null;
  const distance=(a,b)=>Math.hypot(a.x-b.x,a.y-b.y);
  const scheduleRender=()=>{if(pinchDebounce) return; pinchDebounce=setTimeout(()=>{pinchDebounce=null;if(currentPdfDoc) renderPdfDocument(currentPdfDoc);},60);}
  window.addEventListener('pointerdown',ev=>{if(ev.pointerType!=='touch') return; pointerMap.set(ev.pointerId,{x:ev.clientX,y:ev.clientY}); if(pointerMap.size===2){const pts=Array.from(pointerMap.values()); pinchInitialDistance=distance(pts[0],pts[1]); pinchInitialZoom=zoomFactor; ev.preventDefault && ev.preventDefault();}}, {passive:false});
  window.addEventListener('pointermove',ev=>{if(ev.pointerType!=='touch'||!pointerMap.has(ev.pointerId)) return; pointerMap.set(ev.pointerId,{x:ev.clientX,y:ev.clientY}); if(pointerMap.size===2 && pinchInitialDistance && pinchInitialZoom!=null){const pts=Array.from(pointerMap.values()); const curDist=distance(pts[0],pts[1]); if(curDist>0){zoomFactor=Math.max(0.125, Math.min(10, pinchInitialZoom*curDist/pinchInitialDistance)); scheduleRender();} ev.preventDefault && ev.preventDefault();}}, {passive:false});
  window.addEventListener('pointerup',ev=>{if(ev.pointerType!=='touch') return; pointerMap.delete(ev.pointerId); if(pointerMap.size<2){pinchInitialDistance=null; pinchInitialZoom=null; if(currentPdfDoc) renderPdfDocument(currentPdfDoc);}});
  window.addEventListener('pointercancel',ev=>{pointerMap.delete(ev.pointerId); pinchInitialDistance=null; pinchInitialZoom=null;});
}

/* Load first PDF */
selectEntry(pdfIndexData[0]).catch(e=>console.error(e));
</script>
</body>
</html>
